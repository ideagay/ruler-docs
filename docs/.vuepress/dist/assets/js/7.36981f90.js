(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{175:function(a,n,e){"use strict";e.r(n);var s=e(0),t=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,n=a.$createElement,e=a._self._c||n;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#data","aria-hidden":"true"}},[a._v("#")]),a._v(" Data")]),a._v(" "),e("pre",[e("code",[a._v("import {Data} from '@souche-f2e/ruler-tool';\n\naccessKey 是你操作其他应用数据时所必需的参数,如果是自己应用的数据,则不用传\n")])]),a._v(" "),e("h2",{attrs:{id:"search"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#search","aria-hidden":"true"}},[a._v("#")]),a._v(" search")]),a._v(" "),e("h3",{attrs:{id:"入参"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    * name <<String>> 表名\n    limit <<Object>> 分页数据 默认{page: 1, pageSize: 20} \n    condition <<Object>> 查询条件 默认 {}\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"出参"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    totalPage\n    currentPage\n    totalNumber\n    perPageNumber\n    data :     [{\n                   _id\n                   name\n                   desc\n                   type\n                   protected\n                   index\n                   defaultValue\n                   updated\n                   created\n               }]\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"用法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("blockquote",[e("p",[a._v("mongodb的操作符都以"),e("code",[a._v("$")]),a._v("来标记")])]),a._v(" "),e("ul",[e("li",[a._v("基础用法")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("let params = {\n    limit: {page: 1, pageSize: 20},\n    name: 'apps',\n    condition: {'name': 'tangeche'},\n    accessKey: 'xxxx'\n}\nData.search(params).then((res) => {\n    console.log(res);\n});\n\n运算符\n- $nor\n- $gt\n- $gte\n- $lt\n- $lte\n- $ne\n- $in\n- $nin\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br")])]),e("ul",[e("li",[a._v("模糊查询($regex)")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("condition: {'name': {$regex: 'test'}} //可以是某个字符串模糊匹配， 也可以是一个正则表达式\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("ul",[e("li",[a._v("复合查询(and | or)")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("condition: [{name: '张三'}, {age: '18'}] //default is $and 相当于{$and: [xxx, xxx, ...]}\ncondition: {$or: [{name: '张三'}, {age: '18'}]}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br")])]),e("h2",{attrs:{id:"aggregatequery"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aggregatequery","aria-hidden":"true"}},[a._v("#")]),a._v(" aggregateQuery")]),a._v(" "),e("h3",{attrs:{id:"入参-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参-2","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("{\n    * name <<String>> 表名\n    limit <<Object>> 分页数据 默认{page: 1, pageSize: 20} \n    condition <<Object>> 查询条件 默认 {}\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("h3",{attrs:{id:"出参-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参-2","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("{\n    totalPage\n    currentPage\n    totalNumber\n    perPageNumber\n    data: [{\n        _id\n        name\n        desc\n        type\n        protected\n        index\n        defaultValue\n        updated\n        created\n    }]\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br")])]),e("h3",{attrs:{id:"用法-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法-2","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("ul",[e("li",[a._v("基础用法")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("let params = {\n    limit: {page: 1, pageSize: 20},\n    name: 'apps',\n    condition: {\n        $unwind: '$fields'\n    },{\n        $match: {'fields.name': 'userId'}\n    },\n    accessKey: 'xxxx'\n}\nData.aggregateQuery()\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br")])]),e("ul",[e("li",[e("p",[a._v("多级嵌套查询($unwind)")]),a._v(" "),e("blockquote",[e("p",[a._v("当一个对象有一个属性是Oject类型的数组的时候， 可以使用$unwind对数组字段进行拆分，然后再使用$match进行查询")])])])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("例：\n{\n    {\n        fields: [{\n            name: 'userId'\n        }, {\n            name: 'roleId'\n        }, {\n            name: 'roleCode'\n        }, {\n            name: 'roleName'\n        }]\n   }, \n   {\n       fields: [{\n           name: 'appName'\n       }, {\n           name: 'version'\n       }, {\n           name: 'createDate'\n       }, {\n           name: 'updateDate'\n       }]\n   },...\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("condition: {\n    $unwind: '$fields'\n},{\n    $match: {'fields.name': 'userId'}\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("ul",[e("li",[a._v("聚合查询($lookup)")])]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("condition: [{\n    $lookup: {\n        from: 'test-blogs',//lowerCase`${appName}-${name}s`  这里appName是Test\n        localField: 'userid',\n        foreignField: 'uid',\n        as: 'blogs'\n    }\n}, {\n    $match: {\n        name: '用户3'\n    }\n}]\n\nfrom // 要关联的表 由于动态创建的表名是以Collection表里appName-names生成的\nlocalField // 主键\nforeignField // 外键\nas //  对应的外键集合的数据，default \"inventory_docs\" \n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br")])]),e("h2",{attrs:{id:"insert"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#insert","aria-hidden":"true"}},[a._v("#")]),a._v(" insert")]),a._v(" "),e("h3",{attrs:{id:"入参-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参-3","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    * name <<String>> 表名\n    data  <<Object|Array(Object)>> 插入数据,必须是你在表结构中定义好的字段\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"出参-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参-3","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("pre",[e("code",[a._v("[{\n    _id\n    name\n    desc\n    type\n    protected\n    index\n    defaultValue\n    updated\n    created\n}]\n")])]),a._v(" "),e("h3",{attrs:{id:"用法-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法-3","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("pre",[e("code",[a._v("let params = {\n    name: 'apps',\n    data: {'name': 'tangeche'},\n    accessKey: 'xxxx'\n}\nData.insert(params).then(res => {\n    console.log(res);\n});\n")])]),a._v(" "),e("h2",{attrs:{id:"update"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update","aria-hidden":"true"}},[a._v("#")]),a._v(" update")]),a._v(" "),e("h3",{attrs:{id:"入参-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参-4","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    * name <<String>> 表名\n    * data  <<Object|Array(Object)>> 更新数据,必须是你在表结构中定义好的字段\n    * ids  <<Array(String)>> 记录的_id 如果传了ids,则会忽略condition,\n    * condition <<Object>> 查询条件 默认 {} 有ids时可不传\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"出参-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参-4","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    _id\n    name\n    desc\n    type\n    protected\n    index\n    defaultValue\n    updated\n    created\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"用法-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法-4","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("pre",[e("code",[a._v("let params = {\n    name: 'apps',\n    data: {'name': 'tangeche'},\n    ids: ['1', '2'],\n    condition: {'age': 20},\n    accessKey: 'xxxx'\n}\nData.update(params).then(res => {\n    console.log(res);\n});\n")])]),a._v(" "),e("h2",{attrs:{id:"insertandupdate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#insertandupdate","aria-hidden":"true"}},[a._v("#")]),a._v(" insertAndUpdate")]),a._v(" "),e("h3",{attrs:{id:"入参-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参-5","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    * name <<String>> 表名\n    * data  <<Object|Array(Object)>> 更新数据,必须是你在表结构中定义好的字段\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"出参-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参-5","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("pre",[e("code",[a._v("[{\n    _id\n    name\n    desc\n    type\n    protected\n    index\n    defaultValue\n    updated\n    created\n}]\n")])]),a._v(" "),e("h3",{attrs:{id:"用法-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法-5","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("pre",[e("code",[a._v("let params = {\n    name: 'apps',\n    data: {'name': 'tangeche'},\n    accessKey: 'xxxx'\n}\nData.insertAndUpdate(params).then(res => {\n    console.log(res);\n});\n")])]),a._v(" "),e("h2",{attrs:{id:"delete"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#delete","aria-hidden":"true"}},[a._v("#")]),a._v(" delete")]),a._v(" "),e("h3",{attrs:{id:"入参-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#入参-6","aria-hidden":"true"}},[a._v("#")]),a._v(" 入参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    * name <<String>> 表名\n    * ids  <<Array(String)>> 记录的_id 如果传了ids,则会忽略condition,\n    * condition <<Object>> 查询条件 默认 {} 有ids时可不传\n    accessKey <<String>> 权限key值\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"出参-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#出参-6","aria-hidden":"true"}},[a._v("#")]),a._v(" 出参")]),a._v(" "),e("pre",[e("code",[a._v("{\n    _id\n    name\n    desc\n    type\n    protected\n    index\n    defaultValue\n    updated\n    created\n}\n")])]),a._v(" "),e("h3",{attrs:{id:"用法-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#用法-6","aria-hidden":"true"}},[a._v("#")]),a._v(" 用法")]),a._v(" "),e("pre",[e("code",[a._v("let params = {\n    name: 'apps',\n    ids: ['1', '2'],\n    condition: {'name': 'tangeche'},\n    accessKey: 'xxxx'\n}\n\nData.delete(params).then(res => {\n    console.log(res);\n});\n")])])])}],!1,null,null,null);t.options.__file="data.md";n.default=t.exports}}]);